<%- include('partials/header.ejs') %>
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/list.css">
    <link rel="stylesheet" href="/css/modal.css">
</head>
<body>
<%- include('partials/realHeader') %>
<%- include('partials/locationInfo') %>
    <section class="bigContainer">
    <section class="intro">
        <% if (siteInfo.siteName.length > 8) { %>
                    <h1 style="font-size: 2rem; text-shadow: 3px 3px var(--color1);"><%= siteInfo.siteName %></h1>    
                <% } else { %> 
                    <h1><%= siteInfo.siteName %></h1>
                <% } %>
        <button id="myBtn">Add a Post</button>
    </section>
    <!-- <ul>
        <% for (const post of posts) { %>
        <li>
            <section class = "date">
                <% const monthNames = ["January", "February", "March", "April", "May","June","July", "August", "September", "October", "November","December"] %>
                <p><%= monthNames[post.createdAt.getMonth()] %> <%= post.createdAt.getDate() %>,<%= post.createdAt.getFullYear() %>, <%= post.createdAt.getHours() > 12 ?  post.createdAt.getHours()-12: post.createdAt.getHours()%>:<%= post.createdAt.getSeconds() %><%= post.createdAt.getHours() > 12 ? 'pm': 'am' %></p>
            </section>
            <section class="center">
                <section class="title">
                    <%= post.post %>
                </section>
                <% if (post.image) { %>
                <div class="media">
                    <img class="postImage" src="<%= post.image %>">
                </div>
                <% } %>
            </section>

        </li>
                
        <% } %>
    </ul> -->
    <ul>
        <% for (const post of posts) { %>
        <li>
            <section class = "date">
                <% const monthNames = ["January", "February", "March", "April", "May","June","July", "August", "September", "October", "November","December"] %>
                <p><%= monthNames[post.createdAt.getMonth()] %> <%= post.createdAt.getDate() %>,<%= post.createdAt.getFullYear() %>, <%= post.createdAt.getHours() > 12 ?  post.createdAt.getHours()-12: post.createdAt.getHours()%>:<%= String(post.createdAt.getMinutes()).padStart(2,'0') %><%= post.createdAt.getHours() > 11 ? 'pm': 'am' %></p>
            </section>
            <section class="center">
                <section class="title">
                    <%= post.post %>
                </section>
                <% if (post.image) { %>
                <div class="media">
                    <img class="postImage" src="<%= post.image %>">
                </div>
                <% } %>
            </section>
            <section class="marqueeContainer">
                
                <section class="marquee">
                
                <% if (comments[post._id]) { %> 
                    
                    <p class="commentText">
                    <% comments[post._id].forEach(comment =>{ %>
                        
                        <span>|</span> &emsp; 
                        <span><%=comment.userName %>- </span>
                        <%= comment.comment %> 
                        &emsp; <span>|</span>
                        
                    <% }) %>
                    </p>
                <% } %>
                
                </section>
            </section>
            <section class="actions">
                <section class="buttons">

                    
                    <button class="btn comments"><span><i class="fa-solid fa-comment"></i></span></button>
                    
                    <button class="btn"><span><i class="fa-solid fa-thumbtack"></i></span></button>
                </section>
            </section>
            <section class="commentPopup">
                <form
                    action="/comment/createComment/<%= post._id %>/<%= siteInfo._id %>"
                    method="POST"
                >
                    <label for="comment">Your Comment:</label>
                    <textarea class="commentArea" id="comment" name="comment"></textarea>
                    <button class="submitComment">Add Comment</button>
                </form>
            </section>    
        </li>
                
        <% } %>
    </ul>
    </section>
    
    </section>

<!-- Modal structure taken from w3schools: https://www.w3schools.com/howto/howto_css_modals.asp -->
    <div id="myModal" class="modal">

    <!-- Modal content -->
    <div class="modal-content">
    <form class="postInput" action="/post/createPost" enctype="multipart/form-data" method="POST">
        <section class="options">
            <button type="button" id="close">Cancel</button>
            <section class="button">
                <button type="submit" class="btn" value="Upload">Post</button>
            </section>
        </section>
        <textarea class="form-control" maxlength="300" cols=70 rows="10" id="post" name="post"></textarea>
        <section class="input">
            <section class="file">
                Attach a file:
                <label for="imageUpload"><span><i class="fa-regular fa-image"></i></span></label>
                <input type="file" class="form-control" id="imageUpload" name="file">
            </section>
            <section class="charCount">
                <p>Character's Left: </p><p id="charCount">300</p>
            </section>
        </section>
        
    </form>
    </div>

    </div>
    <script type="application/javascript" src="/js/modal.js"></script>
<%- include("partials/footer") %>